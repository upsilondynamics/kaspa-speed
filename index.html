<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kaspa + Blockchain Speed Visualization</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .track {
      height: 18px;
      overflow: hidden;
      background-color: #374151;
      position: relative;
      border-radius: 10px;
    }

    .track-slim {
      height: 8px;
    }

    .block {
      position: absolute;
      height: 100%;
      width: 20px;
      border-radius: 4px;
      animation-name: move;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }

    @keyframes move {
      from { left: -20px; }
      to { left: 100%; }
    }

    .title {
      margin-bottom: 0px !important;	  
    }
	
	.header {
	  margin-top:0px !important;	
	  margin-bottom:7px !important;
	}
	
	.metric-banner {
		margin-bottom:10px;	
	}
	
  </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-start min-h-screen p-3 space-y-6">

  <h1 class="text-xl font-bold text-center title">Kaspa & Blockchain Block Speeds</h1>

  <!-- Real-time Kaspa section -->
  <div class="space-y-1 w-full max-w-3xl mx-auto text-sm header">
    <div class="flex justify-center sm:justify-between items-center text-xs sm:text-sm gap-6 text-gray-300 metric-banner">
      <div>Real-Time Kaspa BPS: <span id="realTimeBps" class="text-white font-semibold">10.00</span></div>
      <div>Block Height: <span id="blockHeight" class="text-white font-semibold">Loading...</span></div>
    </div>
    <div>Kaspa 10BPS (Mainnet): <span id="counter-kaspa" class="font-semibold">0</span></div>
    <div class="track">
      <div class="block bg-green-500" id="kaspaBlock"></div>
    </div>
  </div>

  <!-- Other chains -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[30rem] overflow-y-auto w-full max-w-6xl px-2" id="chains">
    <!-- Chains will be injected here -->
  </div>

  <!-- IFrame -->
  <iframe src="https://kgi.kaspad.net/" class="w-full max-w-6xl h-72 border rounded-md shadow-lg" frameborder="0"></iframe>

  <!-- Footer -->
  <div class="text-xs opacity-70 text-center pb-3 px-4">
    Each moving block represents one blockchain block. Speeds are real or estimated for visual comparison.
  </div>

  <script>
    // Kaspa real-time logic
    let kaspaCounter = 0;
    let animationInterval = null;
    const bpsHistory = [];
    let lastSample = null;

    function startBlockAnimation(bps) {
      clearInterval(animationInterval);
      const interval = 1000 / bps;
      animationInterval = setInterval(() => {
        kaspaCounter++;
        document.getElementById("counter-kaspa").innerText = kaspaCounter;
      }, interval);
      document.getElementById("kaspaBlock").style.animationDuration = (1 / bps).toFixed(3) + "s";
    }

    // Start with 10 BPS default animation
    startBlockAnimation(10);

    async function fetchBlockHeight() {
      try {
        const response = await fetch('https://api.kaspa.org/info/blockdag');
        const data = await response.json();
        return parseInt(data.virtualDaaScore);
      } catch (e) {
        console.error("Failed to fetch block height", e);
        return null;
      }
    }

    async function updateKaspaStats() {
      const currentScore = await fetchBlockHeight();
      const currentTime = Date.now();

      if (currentScore === null) return;
      document.getElementById("blockHeight").innerText = currentScore;

      if (lastSample !== null) {
        const deltaBlocks = currentScore - lastSample.score;
        const deltaSeconds = (currentTime - lastSample.time) / 1000;
        if (deltaSeconds > 0) {
          const currentBps = deltaBlocks / deltaSeconds;
          bpsHistory.push(currentBps);
          if (bpsHistory.length > 5) bpsHistory.shift();
          const avgBps = bpsHistory.reduce((a, b) => a + b, 0) / bpsHistory.length;
          const clampedBps = Math.max(1, Math.min(20, avgBps)).toFixed(2);
          document.getElementById("realTimeBps").innerText = clampedBps;
          startBlockAnimation(parseFloat(clampedBps));
        }
      }

      lastSample = { score: currentScore, time: currentTime };
    }

    updateKaspaStats();
    setInterval(updateKaspaStats, 5000);

    // Other chains
    const chains = [
      { name: 'Solana (~2.5 Blocks/sec)', speed: 2.5, color: 'bg-blue-500', consensus: 'PoS' },
      { name: 'HyperLiquid (~2 Blocks/sec)', speed: 2, color: 'bg-indigo-500', consensus: 'PoS' },
      { name: 'Tron (~0.33 Blocks/sec)', speed: 0.33, color: 'bg-pink-500', consensus: 'PoS' },
      { name: 'SUI (~0.4 Blocks/sec)', speed: 0.4, color: 'bg-purple-500', consensus: 'PoS' },
      { name: 'Ethereum (~0.07 Blocks/sec)', speed: 0.07, color: 'bg-orange-500', consensus: 'PoS' },
      { name: 'Litecoin (~0.016 Blocks/sec)', speed: 0.016, color: 'bg-red-500', consensus: 'PoW' },
      { name: 'Bitcoin (~0.000166 Blocks/sec)', speed: 0.000166, color: 'bg-yellow-500', consensus: 'PoW' },
    ];

    chains.sort((a, b) => b.speed - a.speed);

    chains.forEach(chain => {
      const safeName = chain.name.replace(/[^a-zA-Z0-9]/g, '-');
      const container = document.createElement('div');
      container.innerHTML = `
        <div class="mb-1 text-sm flex items-center gap-2 flex-wrap">
          <span>${chain.name}</span>
          <span class="text-[10px] bg-gray-600 rounded px-1 text-white">${chain.consensus}</span>
          <span>- Blocks: <span id="counter-${safeName}" class="font-semibold">0</span></span>
        </div>
        <div class="track track-slim">
          <div class="block ${chain.color}" style="animation-duration: ${1 / chain.speed}s;"></div>
        </div>
      `;
      document.getElementById('chains').appendChild(container);

      let counter = 0;
      setInterval(() => {
        counter++;
        document.getElementById(`counter-${safeName}`).innerText = counter;
      }, 1000 / chain.speed);
    });
  </script>
</body>
</html>
